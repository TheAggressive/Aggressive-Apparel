# PHPStan configuration

parameters:
	level: 8
	paths:
		- includes/

	# WordPress bootstrap for analysis
	bootstrapFiles:
		- tests/phpstan-bootstrap.php

	# Stub files for WordPress and WooCommerce type information
	scanFiles:
		- vendor/php-stubs/wordpress-stubs/wordpress-stubs.php
		- vendor/php-stubs/woocommerce-stubs/woocommerce-stubs.php

	# Treat PHP code as if it always runs on PHP 8.2+
	phpVersion: 80200

	# WordPress-specific ignores
	excludePaths:
		- includes/vendor/

	# Ignore specific patterns that need special handling
	ignoreErrors:
		# Ignore missing typehints from arrays
		-
			identifier: missingType.iterableValue

		# wp_register_script_module deps array format varies by WP version
		-
			identifier: argument.type
			message: '#Parameter \#3 \$deps of function wp_register_script_module#'

		# WP_REST_Request is generic but WordPress code rarely annotates the type param
		-
			identifier: missingType.generics
			message: '#WP_REST_Request#'

		# WP_Query->posts is int[]|WP_Post[] â€” strval/intval accept all scalar types
		-
			identifier: argument.type
			message: '#array_map expects .* given#'
			path: includes/WooCommerce/class-advanced-sorting.php

	# Universal object crates - allow dynamic properties on these classes
	universalObjectCratesClasses:
		- WP_Post
		- WP_Term
		- WP_User
		- WP_Comment
		- WP_Query
		- stdClass
