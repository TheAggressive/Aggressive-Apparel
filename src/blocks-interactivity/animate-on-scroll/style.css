/* Reference Tailwind for @apply usage, then import utilities only (no reset) */
@reference 'tailwindcss';
@import 'tailwindcss/utilities';

/**
 * Animate On Scroll Block Styles
 *
 * Styles for the aggressive-apparel/animate-on-scroll block.
 * Applied to both front-end and editor.
 */

.wp-block-animate-on-scroll {

	/* CSS Custom Properties */
	--wp-block-animate-on-scroll-animation-duration: 0.6s;
	--wp-block-animate-on-scroll-stagger-delay: 0.1s;
	--wp-block-animate-on-scroll-stagger-index: 0;
	--wp-block-animate-on-scroll-animation-timing: cubic-bezier(0.4, 0, 0.2, 1);
	--wp-block-animate-on-scroll-slide-distance: 50px;
	--wp-block-animate-on-scroll-blur-amount: 20px;
	--wp-block-animate-on-scroll-zoom-in-start: 0.5;
	--wp-block-animate-on-scroll-zoom-out-start: 1.5;
	--wp-block-animate-on-scroll-rotate-angle: 90deg;
	--wp-block-animate-on-scroll-perspective: 1000px;
	--wp-block-animate-on-scroll-bounce-distance: 30px;
	--wp-block-animate-on-scroll-elastic-distance: 50px;

	/* Base Styles */
	display: block;
	will-change: transform, opacity, filter;

	/* Accessibility: Respect prefers-reduced-motion */
	@media (prefers-reduced-motion: reduce) {

		& > * {
			transition: none !important;
			animation: none !important;
			opacity: 1 !important;
			transform: none !important;
			filter: none !important;
		}
	}

	/* Remove margin-top for constrained blocks */
	:root :where(.is-layout-constrained) > & {
		margin-block-start: 0 !important;
	}

	/* Animation States - Target all direct children including headings and text elements */

	/* Exclude sequence children - they have their own rules */
	&:not(.has-animation-sequence) > * {
		opacity: 0;
		transition: all
			var(--wp-block-animate-on-scroll-animation-duration)
			var(--wp-block-animate-on-scroll-animation-timing);
		transition-delay: var(--wp-block-animate-on-scroll-initial-delay);

		/* Use inline-block for flexibility - works for both block and inline elements, allows transforms */
		display: inline-block;
	}

	/* Reset transforms and filters when visible - must come after animation type selectors */

	/* BUT: Don't apply to sequence children - they have their own rules */
	&:not(.has-animation-sequence).is-visible > * {
		opacity: 1;
		transform: none;
		filter: blur(0);
	}

	/* Animation Sequence: Use data attributes for reliable targeting */
	&.has-animation-sequence {

		/* Base styles for all sequence wrapper divs - ensure they start hidden and can be transformed */

		/* The wrapper divs are applied server-side in render.php */
		> div[data-animate-sequence-type] {
			opacity: 0;
			display: block;
			width: 100%;
			transition: opacity
					var(--wp-block-animate-on-scroll-animation-duration)
					var(--wp-block-animate-on-scroll-animation-timing),
				transform
					var(--wp-block-animate-on-scroll-animation-duration)
					var(--wp-block-animate-on-scroll-animation-timing),
				filter
					var(--wp-block-animate-on-scroll-animation-duration)
					var(--wp-block-animate-on-scroll-animation-timing);
			transition-delay: var(--wp-block-animate-on-scroll-initial-delay);
		}

		/* Sequence: Slide */
		> div[data-animate-sequence-type="slide"] {
			transform-origin: center center;
			opacity: 0;

			&[data-animate-sequence-direction="up"] {
				transform: translateY(var(--wp-block-animate-on-scroll-slide-distance));
			}

			&[data-animate-sequence-direction="down"] {
				transform: translateY(calc(-1 * var(--wp-block-animate-on-scroll-slide-distance)));
			}

			&[data-animate-sequence-direction="left"] {
				transform: translateX(var(--wp-block-animate-on-scroll-slide-distance));
			}

			&[data-animate-sequence-direction="right"] {
				transform: translateX(calc(-1 * var(--wp-block-animate-on-scroll-slide-distance)));
			}
		}

		/* Sequence: Zoom */
		> div[data-animate-sequence-type="zoom"] {
			transform-origin: center center;
			opacity: 0;

			&[data-animate-sequence-direction="in"] {
				transform: scale(var(--wp-block-animate-on-scroll-zoom-in-start));
			}

			&[data-animate-sequence-direction="out"] {
				transform: scale(var(--wp-block-animate-on-scroll-zoom-out-start));
			}
		}

		/* Sequence: Flip */
		> div[data-animate-sequence-type="flip"] {
			transform-origin: center center;
			opacity: 0;

			&[data-animate-sequence-direction="up"] {
				transform: perspective(var(--wp-block-animate-on-scroll-perspective))
					rotateX(var(--wp-block-animate-on-scroll-rotate-angle));
			}

			&[data-animate-sequence-direction="down"] {
				transform: perspective(var(--wp-block-animate-on-scroll-perspective))
					rotateX(calc(-1 * var(--wp-block-animate-on-scroll-rotate-angle)));
			}

			&[data-animate-sequence-direction="left"] {
				transform: perspective(var(--wp-block-animate-on-scroll-perspective))
					rotateY(calc(-1 * var(--wp-block-animate-on-scroll-rotate-angle)));
			}

			&[data-animate-sequence-direction="right"] {
				transform: perspective(var(--wp-block-animate-on-scroll-perspective))
					rotateY(var(--wp-block-animate-on-scroll-rotate-angle));
			}
		}

		/* Sequence: Rotate */
		> div[data-animate-sequence-type="rotate"] {
			transform-origin: center center;
			opacity: 0;

			&[data-animate-sequence-direction="left"] {
				transform: rotate(var(--wp-block-animate-on-scroll-rotate-angle));
			}

			&[data-animate-sequence-direction="right"] {
				transform: rotate(calc(-1 * var(--wp-block-animate-on-scroll-rotate-angle)));
			}
		}

		/* Sequence: Blur */
		> div[data-animate-sequence-type="blur-in"] {
			opacity: 0;
			filter: blur(var(--wp-block-animate-on-scroll-blur-amount));
		}

		/* Sequence: Bounce */
		> div[data-animate-sequence-type="bounce"] {
			transform-origin: center center;
			opacity: 0;

			&[data-animate-sequence-direction="standard"],
			&[data-animate-sequence-direction="spring"] {
				transform: translateY(var(--wp-block-animate-on-scroll-bounce-distance));
			}

			&[data-animate-sequence-direction="elastic"] {
				transform: translateY(var(--wp-block-animate-on-scroll-elastic-distance));
			}
		}

		/* Reset all sequence-specific classes when visible */
		&.is-visible > div[data-animate-sequence-type] {
			opacity: 1 !important;
			transform: none !important;
			filter: blur(0) !important;
		}

		/* Sequence: Slide - Final states when visible */
		&.is-visible > div[data-animate-sequence-type="slide"][data-animate-sequence-direction="up"] {
			opacity: 1 !important;
			transform: translate(0, 0) !important;
		}

		&.is-visible > div[data-animate-sequence-type="slide"][data-animate-sequence-direction="down"] {
			opacity: 1 !important;
			transform: translate(0, 0) !important;
		}

		&.is-visible > div[data-animate-sequence-type="slide"][data-animate-sequence-direction="left"] {
			opacity: 1 !important;
			transform: translate(0, 0) !important;
		}

		&.is-visible > div[data-animate-sequence-type="slide"][data-animate-sequence-direction="right"] {
			opacity: 1 !important;
			transform: translate(0, 0) !important;
		}

		/* Sequence: Zoom - Final states when visible */
		&.is-visible > div[data-animate-sequence-type="zoom"][data-animate-sequence-direction="in"] {
			opacity: 1 !important;
			transform: scale(1) !important;
		}

		&.is-visible > div[data-animate-sequence-type="zoom"][data-animate-sequence-direction="out"] {
			opacity: 1 !important;
			transform: scale(1) !important;
		}

		/* Sequence: Flip - Final states when visible */
		&.is-visible > div[data-animate-sequence-type="flip"][data-animate-sequence-direction="up"] {
			opacity: 1 !important;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective)) rotateX(0) rotateY(0) !important;
		}

		&.is-visible > div[data-animate-sequence-type="flip"][data-animate-sequence-direction="down"] {
			opacity: 1 !important;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective)) rotateX(0) rotateY(0) !important;
		}

		&.is-visible > div[data-animate-sequence-type="flip"][data-animate-sequence-direction="left"] {
			opacity: 1 !important;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective)) rotateX(0) rotateY(0) !important;
		}

		&.is-visible > div[data-animate-sequence-type="flip"][data-animate-sequence-direction="right"] {
			opacity: 1 !important;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective)) rotateX(0) rotateY(0) !important;
		}

		/* Sequence: Rotate - Final states when visible */
		&.is-visible > div[data-animate-sequence-type="rotate"][data-animate-sequence-direction="left"] {
			opacity: 1 !important;
			transform: rotate(0deg) !important;
		}

		&.is-visible > div[data-animate-sequence-type="rotate"][data-animate-sequence-direction="right"] {
			opacity: 1 !important;
			transform: rotate(0deg) !important;
		}

		/* Sequence: Blur - Final state when visible */
		&.is-visible > div[data-animate-sequence-type="blur-in"] {
			opacity: 1 !important;
			filter: blur(0) !important;
		}

		/* Sequence: Bounce - Final states when visible */
		&.is-visible > div[data-animate-sequence-type="bounce"][data-animate-sequence-direction="standard"] {
			opacity: 1 !important;
			animation: bounce-in
				var(--wp-block-animate-on-scroll-animation-duration)
				var(--wp-block-animate-on-scroll-animation-timing)
				forwards;
		}

		&.is-visible > div[data-animate-sequence-type="bounce"][data-animate-sequence-direction="elastic"] {
			opacity: 1 !important;
			animation: elastic-in
				var(--wp-block-animate-on-scroll-animation-duration)
				var(--wp-block-animate-on-scroll-animation-timing)
				forwards;
		}

		&.is-visible > div[data-animate-sequence-type="bounce"][data-animate-sequence-direction="spring"] {
			opacity: 1 !important;
			animation: spring-in
				var(--wp-block-animate-on-scroll-animation-duration)
				var(--wp-block-animate-on-scroll-animation-timing)
				forwards;
		}
	}

	/* Stagger Animation - Combine initial delay with stagger delay */
	&[data-stagger-children="true"] > * {
		transition-delay: calc(
			var(--wp-block-animate-on-scroll-initial-delay) +
			(var(--wp-block-animate-on-scroll-stagger-delay) *
				var(--wp-block-animate-on-scroll-stagger-index))
		);
	}

	/* Stagger Animation for Sequence Mode - Apply to wrapper divs */
	&.has-animation-sequence[data-stagger-children="true"] > div[data-animate-sequence-type] {
		transition-delay: calc(
			var(--wp-block-animate-on-scroll-initial-delay) +
			(var(--wp-block-animate-on-scroll-stagger-delay) *
				var(--wp-block-animate-on-scroll-stagger-index))
		);
	}

	/* Animation Type: Transform Origin - Set center origin for all transform-based animations to ensure scaling/rotation happens from center */
	&.slide > *,
	&.zoom > *,
	&.flip > *,
	&.rotate > *,
	&.bounce > * {
		transform-origin: center center;
	}

	/* Animation Type: Blur In (renamed from 'blur' to avoid Tailwind conflict) */
	&.blur-in > * {
		filter: blur(var(--wp-block-animate-on-scroll-blur-amount));
	}

	&.blur-in.is-visible > * {
		filter: blur(0);
	}

	/* Animation Type: Slide */
	&.slide {

		&.up > * {
			transform: translateY(var(--wp-block-animate-on-scroll-slide-distance));
		}

		&.down > * {
			transform: translateY(calc(-1 * var(--wp-block-animate-on-scroll-slide-distance)));
		}

		&.left > * {
			transform: translateX(var(--wp-block-animate-on-scroll-slide-distance));
		}

		&.right > * {
			transform: translateX(calc(-1 * var(--wp-block-animate-on-scroll-slide-distance)));
		}

		/* Override transforms when visible */
		&.is-visible.up > *,
		&.is-visible.down > *,
		&.is-visible.left > *,
		&.is-visible.right > * {
			transform: translate(0, 0);
		}
	}

	/* Animation Type: Zoom - Scale from center of element */
	&.zoom {

		&.in > * {
			transform-origin: center center;
			transform: scale(var(--wp-block-animate-on-scroll-zoom-in-start));
		}

		&.out > * {
			transform-origin: center center;
			transform: scale(var(--wp-block-animate-on-scroll-zoom-out-start));
		}

		/* Override transforms when visible */
		&.is-visible.in > *,
		&.is-visible.out > * {
			transform: scale(1);
		}
	}

	/* Animation Type: Flip - Rotate from center of element */
	&.flip {

		&.up > * {
			transform-origin: center center;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective))
				rotateX(var(--wp-block-animate-on-scroll-rotate-angle));
		}

		&.down > * {
			transform-origin: center center;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective))
				rotateX(calc(-1 * var(--wp-block-animate-on-scroll-rotate-angle)));
		}

		&.left > * {
			transform-origin: center center;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective))
				rotateY(calc(-1 * var(--wp-block-animate-on-scroll-rotate-angle)));
		}

		&.right > * {
			transform-origin: center center;
			transform: perspective(var(--wp-block-animate-on-scroll-perspective))
				rotateY(var(--wp-block-animate-on-scroll-rotate-angle));
		}

		/* Override transforms when visible */
		&.is-visible.up > *,
		&.is-visible.down > *,
		&.is-visible.left > *,
		&.is-visible.right > * {
			transform: perspective(var(--wp-block-animate-on-scroll-perspective)) rotateX(0) rotateY(0);
		}
	}

	/* Animation Type: Rotate - Rotate from center of element */
	&.rotate {

		&.left > * {
			transform-origin: center center;
			transform: rotate(var(--wp-block-animate-on-scroll-rotate-angle));
		}

		&.right > * {
			transform-origin: center center;
			transform: rotate(calc(-1 * var(--wp-block-animate-on-scroll-rotate-angle)));
		}

		/* Override transforms when visible */
		&.is-visible.left > *,
		&.is-visible.right > * {
			transform: rotate(0deg);
		}
	}

	/* Animation Type: Bounce - with variations */
	&.bounce > * {
		transform: translateY(var(--wp-block-animate-on-scroll-bounce-distance));
		opacity: 0;
	}

	/* Standard bounce */
	&.bounce.standard.is-visible > *,
	&.bounce.is-visible > * {
		animation: bounce-in
			var(--wp-block-animate-on-scroll-animation-duration)
			var(--wp-block-animate-on-scroll-animation-timing)
			forwards;
	}

	/* Elastic bounce variation */
	&.bounce.elastic > * {
		transform: translateY(var(--wp-block-animate-on-scroll-elastic-distance));
	}

	&.bounce.elastic.is-visible > * {
		animation: elastic-in
			var(--wp-block-animate-on-scroll-animation-duration)
			var(--wp-block-animate-on-scroll-animation-timing)
			forwards;
	}

	/* Spring bounce variation */
	&.bounce.spring > * {
		transform: translateY(var(--wp-block-animate-on-scroll-bounce-distance));
	}

	&.bounce.spring.is-visible > * {
		animation: spring-in
			var(--wp-block-animate-on-scroll-animation-duration)
			var(--wp-block-animate-on-scroll-animation-timing)
			forwards;
	}
}

/**
 * Keyframe Animations
 */

@keyframes bounce-in {

	0% {
		transform: translateY(var(--wp-block-animate-on-scroll-bounce-distance));
		opacity: 0;
	}

	60% {
		transform: translateY(-10px);
		opacity: 1;
	}

	80% {
		transform: translateY(5px);
	}

	100% {
		transform: translateY(0);
		opacity: 1;
	}
}

@keyframes elastic-in {

	0% {
		transform: translateY(var(--wp-block-animate-on-scroll-elastic-distance))
			scaleY(0.8);
		opacity: 0;
	}

	50% {
		transform: translateY(-15px) scaleY(1.1);
		opacity: 0.8;
	}

	70% {
		transform: translateY(8px) scaleY(0.95);
		opacity: 0.9;
	}

	85% {
		transform: translateY(-4px) scaleY(1.02);
		opacity: 0.95;
	}

	100% {
		transform: translateY(0) scaleY(1);
		opacity: 1;
	}
}

@keyframes spring-in {

	0% {
		transform: translateY(var(--wp-block-animate-on-scroll-bounce-distance))
			scale(0.8);
		opacity: 0;
	}

	40% {
		transform: translateY(-20px) scale(1.05);
		opacity: 0.9;
	}

	60% {
		transform: translateY(10px) scale(0.98);
		opacity: 0.95;
	}

	80% {
		transform: translateY(-5px) scale(1.01);
		opacity: 0.98;
	}

	100% {
		transform: translateY(0) scale(1);
		opacity: 1;
	}
}

/**
 * Debug Overlays
 */

/* Detection Boundary Overlay */
.wp-block-animate-on-scroll-debug-detection-boundary-overlay {

	@apply pointer-events-none fixed z-[999] border-2 border-dashed border-red-700 bg-red-200/60 backdrop-grayscale;

	inset: var(--wp-block-animate-on-scroll-detection-boundary-overlay-top)
		var(--wp-block-animate-on-scroll-detection-boundary-overlay-right)
		var(--wp-block-animate-on-scroll-detection-boundary-overlay-bottom)
		var(--wp-block-animate-on-scroll-detection-boundary-overlay-left);

	&::after {

		@apply absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-md bg-red-600 px-2 py-2 text-center text-sm text-white;

		content: "Detection_Boundary";
	}
}

/* Debug Container */
[class*="wp-block-animate-on-scroll-debug-container"] {

	@apply pointer-events-none absolute z-[9999];

	/* Ensure visibility on all devices */
	min-width: 1px;
	min-height: 1px;
	visibility: visible !important;
	display: block !important;
	opacity: 1 !important;

	/* Visibility Trigger Line */
	[class*="wp-block-animate-on-scroll-debug-visibility-trigger-line-"] {

		@apply pointer-events-none absolute z-[9999] h-0.5 w-full -translate-y-px border-t-2 border-dashed border-red-600;

		top: var(--wp-block-animate-on-scroll-debug-visibility-trigger-top);
		background-color: rgb(220 38 38 / 50%);
		visibility: visible !important;
		display: block !important;
		opacity: 1 !important;
	}

	/* Visibility Trigger Label */
	[class*="wp-block-animate-on-scroll-debug-visibility-trigger-line-label-"] {

		@apply absolute left-1/2 z-[9999] flex h-auto w-max -translate-x-1/2 -translate-y-1/2 rounded-md border-none bg-red-600 px-2 py-1 text-center text-xs text-white whitespace-nowrap;

		top: var(--wp-block-animate-on-scroll-debug-visibility-trigger-top);
		max-width: 90vw;
		font-size: 0.75rem;
		line-height: 1.2;
		visibility: visible !important;
		display: flex !important;
		opacity: 1 !important;
	}
}
