/**
 * Navigation Panel Block Styles
 *
 * Slide-out mobile navigation panel with overlay, focus management, and drill-down support.
 * Supports multiple animation styles: slide, push, reveal, and fade.
 *
 * @package Aggressive_Apparel
 */

.wp-block-aggressive-apparel-navigation-panel {
  --panel-width: min(320px, 85vw);
  --panel-bg: var(--wp--preset--color--white, #fff);
  --panel-color: var(--wp--preset--color--black, #000);
  --panel-transition: var(--aa-nav-transition, 300ms cubic-bezier(0.4, 0, 0.2, 1));
  --panel-overlay-bg: var(--aa-nav-overlay-bg, rgb(0 0 0 / 50%));
  --panel-z-index: 99999;
  --panel-header-height: 60px;

  position: fixed;
  inset: 0;
  z-index: var(--panel-z-index);

  /* Panel wrapper is always visible but non-interactive when closed.
   * The actual hiding is done via pointer-events and the content transform.
   * This allows CSS transitions to animate properly. */
  visibility: visible;
  opacity: 1;
  pointer-events: none;

  /* Open state - enable pointer events for interaction. */
  &.is-open {
    pointer-events: auto;
  }

  /* Overlay. */
  &__overlay {
    position: absolute;
    inset: 0;
    background: var(--panel-overlay-bg);
    opacity: 0;
    transition: opacity var(--panel-transition, 300ms cubic-bezier(0.4, 0, 0.2, 1));
    cursor: pointer;
  }

  &.is-open &__overlay {
    opacity: 1;
    pointer-events: auto;
  }

  /* Panel content container. */
  &__content {
    position: absolute;
    top: 0;
    bottom: 0;
    width: var(--panel-width);
    background: var(--panel-bg);
    color: var(--panel-color);
    overflow: visible;
    display: flex;
    flex-direction: column;
    box-shadow: -4px 0 24px rgb(0 0 0 / 15%);
    transition:
      transform var(--panel-transition, 300ms cubic-bezier(0.4, 0, 0.2, 1)),
      opacity var(--panel-transition, 300ms cubic-bezier(0.4, 0, 0.2, 1));

    /* Ensure all SVGs inside panel inherit fill color from parent */
    & svg {
      fill: currentcolor;
    }

    /* Preserve fill="none" for stroke-only icons (chevrons, close, etc.) */
    & svg[fill="none"] {
      fill: none;
    }
  }

  /* Note: Panel header, body, and footer styling is handled by dedicated blocks:
   * - aggressive-apparel/panel-header
   * - aggressive-apparel/panel-body
   * - aggressive-apparel/panel-footer
   */

  /* ========================================
   * DEFAULT POSITION STYLES
   * ======================================== */
  &--right &__content {
    right: 0;
  }

  &--left &__content {
    left: 0;
    box-shadow: 4px 0 24px rgb(0 0 0 / 15%);
  }

  /* ========================================
   * ANIMATION STYLE: SLIDE (default)
   * Panel slides in from the side.
   * ======================================== */

  /* Slide - Right position (default). */
  &--slide&--right &__content {
    right: 0;
    transform: translateX(100%);
  }

  &--slide&--right&.is-open &__content {
    transform: translateX(0);
  }

  /* Slide - Left position. */
  &--slide&--left &__content {
    left: 0;
    transform: translateX(-100%);
  }

  &--slide&--left&.is-open &__content {
    transform: translateX(0);
  }

  /* ========================================
   * ANIMATION STYLE: PUSH
   * Panel slides in AND pushes page content.
   * ======================================== */
  &--push {
    pointer-events: none;

    &.is-open {
      pointer-events: none;
    }

    & .wp-block-aggressive-apparel-navigation-panel__content {
      pointer-events: auto;
    }

    /* Push - Right position. */
    &.wp-block-aggressive-apparel-navigation-panel--right .wp-block-aggressive-apparel-navigation-panel__content {
      right: 0 !important;
      left: auto !important;
      transform: translateX(100%);
    }

    &.wp-block-aggressive-apparel-navigation-panel--right.is-open .wp-block-aggressive-apparel-navigation-panel__content {
      transform: translateX(0);
    }

    /* Push - Left position. */
    &.wp-block-aggressive-apparel-navigation-panel--left .wp-block-aggressive-apparel-navigation-panel__content {
      left: 0 !important;
      right: auto !important;
      transform: translateX(-100%);
    }

    &.wp-block-aggressive-apparel-navigation-panel--left.is-open .wp-block-aggressive-apparel-navigation-panel__content {
      transform: translateX(0);
    }
  }

  /* ========================================
   * ANIMATION STYLE: REVEAL
   * Page slides to reveal panel underneath.
   * ======================================== */
  &--reveal {
    z-index: 9998;
    pointer-events: none;

    &.is-open {
      z-index: 9998;
      pointer-events: none;
    }

    & .wp-block-aggressive-apparel-navigation-panel__content {
      pointer-events: auto;
      transition: none;
    }

    &.wp-block-aggressive-apparel-navigation-panel--right .wp-block-aggressive-apparel-navigation-panel__content {
      right: 0 !important;
      left: auto !important;
      transform: translateX(0) !important;
    }

    &.wp-block-aggressive-apparel-navigation-panel--left .wp-block-aggressive-apparel-navigation-panel__content {
      left: 0 !important;
      right: auto !important;
      transform: translateX(0) !important;
    }
  }

  /* ========================================
   * ANIMATION STYLE: FADE
   * Panel fades in (no slide).
   * ======================================== */
  &--fade &__content {
    opacity: 0;
    transform: scale(0.98);
  }

  &--fade&.is-open &__content {
    opacity: 1;
    transform: scale(1);
  }

  &--fade&--right &__content {
    right: 0;
  }

  &--fade&--left &__content {
    left: 0;
  }

  /* Note: Close button styling is handled by the panel-close-button block.
   * Link styles are handled by the panel-body block. */

  /* ========================================
   * DRILL-DOWN NAVIGATION STYLES
   * ======================================== */

  /* Drilldown panels use fixed positioning to escape panel-body's overflow-x: hidden.
   * They position themselves to match the navigation panel's content area. */
  & .wp-block-aggressive-apparel-nav-submenu--drilldown .wp-block-aggressive-apparel-nav-submenu__panel {
    position: fixed;
    top: var(--panel-header-height, 60px);
    bottom: 0;
    width: var(--panel-width, min(320px, 85vw));
    background: var(--panel-bg, #fff);
    transform: translateX(100%);
    transition: transform var(--panel-transition, 300ms cubic-bezier(0.4, 0, 0.2, 1));
    z-index: 100;
    overflow-y: auto;
    padding: 0 var(--wp--preset--spacing--4, 1rem);
    box-sizing: border-box;
  }

  /* Right-positioned panel: drilldown slides from right edge */
  &--right .wp-block-aggressive-apparel-nav-submenu--drilldown .wp-block-aggressive-apparel-nav-submenu__panel {
    right: 0;
    left: auto;
  }

  /* Left-positioned panel: drilldown slides from left edge */
  &--left .wp-block-aggressive-apparel-nav-submenu--drilldown .wp-block-aggressive-apparel-nav-submenu__panel {
    left: 0;
    right: auto;
    transform: translateX(-100%);
  }

  & .wp-block-aggressive-apparel-nav-submenu--drilldown.is-open .wp-block-aggressive-apparel-nav-submenu__panel {
    transform: translateX(0);
  }

  /* Remove the extra padding from nav-submenu base styles when inside panel */
  & .wp-block-aggressive-apparel-nav-submenu--drilldown .wp-block-aggressive-apparel-nav-submenu__panel-inner {
    padding-top: 0;
  }
}

/* ========================================
 * PUSH/REVEAL: Page content positioning
 * Applied to the body when panel is open.
 * ======================================== */

/* Base transition on .wp-site-blocks so it animates both open and close. */
.wp-site-blocks {
  position: relative;
  left: 0;
  right: 0;
  transition: left 300ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Push Right */
body.has-navigation-panel-open--push-right {
  --push-panel-width: min(320px, 85vw);

  overflow-x: hidden;

  & .wp-site-blocks {
    left: calc(var(--push-panel-width) * -1);
  }
}

/* Push Left */
body.has-navigation-panel-open--push-left {
  --push-panel-width: min(320px, 85vw);

  overflow-x: hidden;

  & .wp-site-blocks {
    left: var(--push-panel-width);
  }
}

/* Reveal Right */
body.has-navigation-panel-open--reveal-right {
  --push-panel-width: min(320px, 85vw);

  overflow-x: hidden;

  & .wp-site-blocks {
    left: calc(var(--push-panel-width) * -1);
    z-index: 9999;
    background: inherit;
  }
}

/* Reveal Left */
body.has-navigation-panel-open--reveal-left {
  --push-panel-width: min(320px, 85vw);

  overflow-x: hidden;

  & .wp-site-blocks {
    left: var(--push-panel-width);
    z-index: 9999;
    background: inherit;
  }
}

/* ========================================
 * GLASSMORPHISM EFFECT
 * Premium frosted glass aesthetic for panel.
 * ======================================== */
@supports (backdrop-filter: blur(1px)) {

  .wp-block-aggressive-apparel-navigation-panel__content {
    background: rgb(255 255 255 / 90%);
    backdrop-filter: blur(20px) saturate(180%);
    border-left: 1px solid rgb(255 255 255 / 20%);
  }

  .wp-block-aggressive-apparel-navigation-panel--left .wp-block-aggressive-apparel-navigation-panel__content {
    border-left: none;
    border-right: 1px solid rgb(255 255 255 / 20%);
  }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {

    .wp-block-aggressive-apparel-navigation-panel__content {
      background: rgb(0 0 0 / 85%);
      border-color: rgb(255 255 255 / 10%);
    }
  }
}

/* ========================================
 * VIEW TRANSITIONS API
 * Smooth state transitions for panel open/close.
 * ======================================== */
@supports (view-transition-name: none) {

  .wp-block-aggressive-apparel-navigation-panel__content {
    view-transition-name: navigation-panel;
  }

  .wp-block-aggressive-apparel-navigation-panel__overlay {
    view-transition-name: navigation-overlay;
  }
}

/* ========================================
 * @starting-style ENTRY ANIMATIONS
 * Smooth entry animations for panel appearance.
 * ======================================== */
@supports selector(@starting-style) {

  .wp-block-aggressive-apparel-navigation-panel {
    transition:
      opacity var(--panel-transition),
      visibility var(--panel-transition),
      display var(--panel-transition) allow-discrete;

    @starting-style {

      &.is-open {
        opacity: 0;
      }

      &.is-open .wp-block-aggressive-apparel-navigation-panel__overlay {
        opacity: 0;
      }

      &--slide&--right.is-open .wp-block-aggressive-apparel-navigation-panel__content {
        transform: translateX(100%);
      }

      &--slide&--left.is-open .wp-block-aggressive-apparel-navigation-panel__content {
        transform: translateX(-100%);
      }

      &--fade.is-open .wp-block-aggressive-apparel-navigation-panel__content {
        opacity: 0;
        transform: scale(0.95);
      }
    }
  }
}

/* ========================================
 * CONTENT-VISIBILITY PERFORMANCE
 * Skip rendering hidden panel content.
 * ======================================== */
@supports (content-visibility: auto) {

  .wp-block-aggressive-apparel-navigation-panel:not(.is-open) .wp-block-aggressive-apparel-panel-body {
    content-visibility: hidden;
    contain-intrinsic-size: auto 500px;
  }
}

/* Reduced motion. */
@media (prefers-reduced-motion: reduce) {

  .wp-block-aggressive-apparel-navigation-panel {
    --panel-transition: 0ms;
  }

  .wp-site-blocks {
    transition: none;
  }

  /* Disable View Transitions for reduced motion */
  @supports (view-transition-name: none) {

    .wp-block-aggressive-apparel-navigation-panel__content,
    .wp-block-aggressive-apparel-navigation-panel__overlay {
      view-transition-name: none !important;
    }
  }
}
