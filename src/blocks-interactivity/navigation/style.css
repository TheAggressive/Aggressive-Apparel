/**
 * Navigation Block Styles
 *
 * @package Aggressive_Apparel
 */

/* ========================================
 * SHARED CSS VARIABLES
 * Used across all navigation blocks.
 * Defined at :root for fixed-position elements (panel).
 * ======================================== */
:root {

  /* Borders */
  --aa-nav-border-subtle: rgb(0 0 0 / 8%);
  --aa-nav-border-light: rgb(0 0 0 / 10%);

  /* Overlays & Hover */
  --aa-nav-hover-bg: rgb(0 0 0 / 5%);
  --aa-nav-shadow: 0 4px 20px rgb(0 0 0 / 15%);
  --aa-nav-overlay-bg: rgb(0 0 0 / 50%);

  /* Transitions - standard easing */
  --aa-nav-transition: 300ms cubic-bezier(0.4, 0, 0.2, 1);
  --aa-nav-transition-fast: 150ms ease;


  /* Radii */
  --aa-nav-radius-sm: 2px;
  --aa-nav-radius-md: 4px;
  --aa-nav-radius-lg: 8px;

  /* Focus */
  --aa-nav-focus-color: var(--wp--preset--color--primary, currentColor);
  --aa-nav-focus-width: 2px;
  --aa-nav-focus-offset: 2px;
}


/* Screen reader only text utility. */
.screen-reader-text {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip-path: inset(50%) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

.wp-block-aggressive-apparel-navigation {
  --navigation-gap: var(--wp--preset--spacing--6, 1.5rem);
  --navigation-transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
  --navigation-breakpoint: 1024px;

  position: relative;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--navigation-gap);

  /* Default desktop state: Show nav menu, hide toggle & panel. */
  & .wp-block-aggressive-apparel-nav-menu {
    display: flex;
    align-items: center;
    gap: var(--navigation-gap);
  }

  /* Default: toggle and panel hidden on desktop, handled by is-mobile/is-desktop classes */
  & .wp-block-aggressive-apparel-menu-toggle {
    display: none;
  }

  /* Fallback: Show toggle on mobile when no JS classes are present yet */
  @media (width <= 1023px) {

    & .wp-block-aggressive-apparel-menu-toggle {
      display: flex;
    }
  }

  /* Navigation panel: Layout reset only. Visibility is controlled by the panel's own styles. */
  & .wp-block-aggressive-apparel-navigation-panel {
    display: block;
  }

  /* JS-controlled mobile state via is-mobile class. */
  &.is-mobile {

    /* Show toggle button on mobile */
    & .wp-block-aggressive-apparel-menu-toggle {
      display: flex;
    }

    /* Hide desktop nav-menu on mobile (but not ones inside the panel). */
    & > .wp-block-aggressive-apparel-nav-menu,
    & > .is-layout-flex > .wp-block-aggressive-apparel-nav-menu {
      display: none;
    }

    /* Show the mobile navigation panel container */
    & .wp-block-aggressive-apparel-navigation-panel {
      display: block;
      height: auto;
      overflow: visible;

      /* Visibility controlled by panel's own state (is-open) */
    }

    /* Nav menus inside the panel should be visible and vertical. */
    & .wp-block-aggressive-apparel-navigation-panel .wp-block-aggressive-apparel-nav-menu {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 0;
    }

    /* Mobile touch target sizing - ensure 44px minimum for accessibility. */
    & .wp-block-aggressive-apparel-navigation-panel .wp-block-aggressive-apparel-nav-link__link {
      min-height: 44px;
      display: flex;
      align-items: center;
      padding: 0.75rem 0;
    }

    /* Mobile submenu behavior: accordion style inside panel. */
    & .wp-block-aggressive-apparel-navigation-panel .wp-block-aggressive-apparel-nav-submenu {
      display: block;
      position: static;
      width: 100%;

      & .wp-block-aggressive-apparel-nav-submenu__trigger {
        width: 100%;
      }

      & .wp-block-aggressive-apparel-nav-submenu__link {
        width: 100%;
        justify-content: space-between;
        min-height: 44px;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--aa-nav-border-subtle);
      }

      /* Override hidden behavior for accordion animation. */
      & .wp-block-aggressive-apparel-nav-submenu__panel {
        position: static;
        width: 100%;
        max-height: 0;
        overflow: hidden;
        box-shadow: none;
        border-radius: 0;
        background: transparent;
        opacity: 1;
        visibility: visible;
        pointer-events: none;
        transform: none;
        transition: max-height var(--navigation-transition);

        /* Override [hidden] to allow accordion animation via max-height. */
        &[hidden] {
          display: block !important;
          opacity: 1 !important;
          visibility: visible !important;
          max-height: 0;
          pointer-events: none;
        }
      }

      &.is-open .wp-block-aggressive-apparel-nav-submenu__panel {
        max-height: 2000px;
        pointer-events: auto;

        &[hidden] {
          max-height: 2000px;
          pointer-events: auto;
        }
      }

      & .wp-block-aggressive-apparel-nav-submenu__panel-inner {
        padding: var(--wp--preset--spacing--4, 1rem) 0;
        padding-inline-start: var(--wp--preset--spacing--6, 1.5rem);
      }
    }
  }

  /* Desktop state is handled by the default CSS rules above (lines 32-68).
     The .is-mobile class toggles mobile-specific behavior.
     When .is-mobile is removed, the default desktop styles apply automatically. */
}

/* ========================================
 * CSS FALLBACK: Works before JS loads
 * Media query fallback for default 1024px breakpoint.
 * For custom breakpoints, JavaScript handles the responsive behavior.
 * ======================================== */
@media (width <= 1023px) {

  .wp-block-aggressive-apparel-navigation:not(.is-mobile) {

    /* Show toggle before JS initializes. */
    & .wp-block-aggressive-apparel-menu-toggle {
      display: flex;
    }

    /* Hide desktop nav-menu before JS initializes. */
    & > .wp-block-aggressive-apparel-nav-menu,
    & > .is-layout-flex > .wp-block-aggressive-apparel-nav-menu {
      display: none;
    }

    /* Show panel container (but it's still hidden until opened). */
    & .wp-block-aggressive-apparel-navigation-panel {
      display: block;
    }
  }
}

/* ========================================
 * CONTAINER QUERIES
 * Component-based responsiveness (not just viewport).
 * ======================================== */
@supports (container-type: inline-size) {

  .wp-block-aggressive-apparel-navigation {
    container-type: inline-size;
    container-name: navigation;
  }

  /* Compact mode for narrow containers */
  @container navigation (max-width: 600px) {

    .wp-block-aggressive-apparel-navigation {
      --navigation-gap: var(--wp--preset--spacing--3, 0.75rem);
    }
  }
}

/* ========================================
 * ENHANCED FOCUS-VISIBLE
 * Better focus indicators for keyboard users.
 * ======================================== */
@supports selector(:focus-visible) {

  .wp-block-aggressive-apparel-navigation :focus:not(:focus-visible) {
    outline: none;
  }

  .wp-block-aggressive-apparel-navigation :focus-visible {
    outline: var(--aa-nav-focus-width, 2px) solid var(--aa-nav-focus-color, currentColor);
    outline-offset: var(--aa-nav-focus-offset, 2px);
    border-radius: var(--aa-nav-radius-sm, 2px);
  }

  /* Focus glow animation (respects reduced motion) */
  @media (prefers-reduced-motion: no-preference) {

    .wp-block-aggressive-apparel-navigation :focus-visible {
      animation: aa-nav-focus-glow 300ms ease-out;
    }

    @keyframes aa-nav-focus-glow {

      from {
        box-shadow: 0 0 0 0 color-mix(in srgb, var(--aa-nav-focus-color) 50%, transparent);
      }

      to {
        box-shadow: 0 0 0 4px transparent;
      }
    }
  }

  /* High contrast mode enhancement */
  @media (forced-colors: active) {

    .wp-block-aggressive-apparel-navigation :focus-visible {
      outline: 3px solid CanvasText;
      outline-offset: 3px;
    }
  }
}

/* ========================================
 * REDUCED MOTION
 * Instant state changes for vestibular safety.
 * ======================================== */
@media (prefers-reduced-motion: reduce) {

  .wp-block-aggressive-apparel-navigation {
    --navigation-transition: 0ms;
  }

  /* Disable all animations and transitions */
  .wp-block-aggressive-apparel-navigation *,
  .wp-block-aggressive-apparel-navigation *::before,
  .wp-block-aggressive-apparel-navigation *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  /* Disable View Transitions for navigation elements */
  @supports (view-transition-name: none) {

    .wp-block-aggressive-apparel-navigation,
    .wp-block-aggressive-apparel-navigation-panel {
      view-transition-name: none !important;
    }
  }
}
