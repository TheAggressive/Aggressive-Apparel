/**
 * Page Transitions
 *
 * MPA View Transitions for smooth cross-page navigation with shared
 * element morphing and staggered content entry.
 *
 * Progressive enhancement — zero impact on unsupported browsers.
 * Browser support: Chrome 126+, Safari 18.2+, Edge 126+.
 *
 * @package Aggressive_Apparel
 * @since 1.18.0
 */

/* ── Enable MPA View Transitions ──────────────────── */

@view-transition {
	navigation: auto;
}

/* ── Named Elements ───────────────────────────────── */

header.wp-block-template-part {
	view-transition-name: site-header;
}

footer.wp-block-template-part {
	view-transition-name: site-footer;
}

main.wp-block-group {
	view-transition-name: main-content;
}

/* ── Header & Footer — Stable, No Animation ──────── */

::view-transition-old(site-header),
::view-transition-new(site-header),
::view-transition-old(site-footer),
::view-transition-new(site-footer) {
	animation: none;
}

/* ── Main Content — Quick Cross-Fade ─────────────── */

/* Shorter than the default 250ms so the image morph is
 * the focal point. No custom keyframes — browser default
 * cross-fade handles height differences cleanly. */
::view-transition-old(main-content) {
	animation-duration: 150ms;
}

::view-transition-new(main-content) {
	animation-duration: 200ms;
}

/* ── Product Image Morph ─────────────────────────── */

/* Scoped via view-transition-class (set in PHP) so these
 * rules only affect product images — not main-content or
 * header/footer. The image "flies" between grid thumbnail
 * and single product hero. */
::view-transition-group(.product-img) {
	animation-duration: 350ms;
	animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
	overflow: clip;
}

::view-transition-old(.product-img),
::view-transition-new(.product-img) {
	height: 100%;
	overflow: clip;
}

/* ── Product Detail Stagger ───────────────────────── */

/* On single product pages, the right column content (title,
 * rating, price, excerpt, add-to-cart, meta) staggers in
 * with 60ms offsets for a deliberate reveal effect.
 *
 * Scoped to .vt-navigated (set by pagereveal script) so the
 * stagger only fires when arriving via a view transition —
 * direct page loads and refreshes render normally. */

@supports (view-transition-name: none) {

	@keyframes aa-vt-stagger-in {

		from {
			opacity: 0;
			transform: translateY(16px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.vt-navigated body.single-product .wp-block-column:last-child > * {
		animation: aa-vt-stagger-in 400ms cubic-bezier(0, 0, 0.2, 1) both;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > :nth-child(1) {
		animation-delay: 60ms;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > :nth-child(2) {
		animation-delay: 120ms;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > :nth-child(3) {
		animation-delay: 180ms;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > :nth-child(4) {
		animation-delay: 240ms;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > :nth-child(5) {
		animation-delay: 300ms;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > :nth-child(n + 6) {
		animation-delay: 360ms;
	}
}

/* ── Navigation Progress Bar ─────────────────────── */

/* Thin top bar for visual feedback during slow navigations.
 * Hidden by default (width:0, opacity:0). JS adds .is-navigating
 * to <body> after 150ms — skipped for prerendered pages.
 * view-transition-name:none prevents morph artifacts. */
body::after {
	content: '';
	position: fixed;
	top: 0;
	left: 0;
	width: 0;
	height: 3px;
	background: var(--wp--preset--color--primary);
	z-index: 999999;
	pointer-events: none;
	opacity: 0;
	view-transition-name: none;
}

@keyframes aa-progress-bar {

	0% {
		width: 0;
		opacity: 1;
	}

	5% {
		width: 5%;
		opacity: 1;
	}

	100% {
		width: 90%;
		opacity: 1;
	}
}

body.is-navigating::after {
	animation: aa-progress-bar 4s cubic-bezier(0.1, 0.5, 0, 1) forwards;
}

/* ── Exclusions ───────────────────────────────────── */

#wpadminbar {
	view-transition-name: none !important;
}

body.woocommerce-checkout main.wp-block-group {
	view-transition-name: none !important;
}

body.woocommerce-cart main.wp-block-group {
	view-transition-name: none !important;
}

/* ── Reduced Motion ───────────────────────────────── */

@media (prefers-reduced-motion: reduce) {

	@view-transition {
		navigation: none;
	}

	.vt-navigated body.single-product .wp-block-column:last-child > * {
		animation: none;
	}

	body.is-navigating::after {
		animation: none;
		width: 100%;
		opacity: 0.3;
	}
}
