/**
 * Variation Pills — Morphing Pill Animation
 *
 * Animated pill buttons for WooCommerce product page variation selectors.
 * Mirrors the quick view / sticky cart / product filter chip pattern:
 * wipe-fill on select, checkmark bounces in, text slides right.
 *
 * Uses :has(input:checked) and input:checked ~ sibling selectors
 * instead of .is-selected since WooCommerce manages radio inputs.
 *
 * @package Aggressive_Apparel
 */

/*
 * 1. Base pill — override WooCommerce defaults.
 *    Pill shape, ghost border, transparent fill.
 */
.aa-variation-pill {
	position: relative;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding: 0.375rem 0.75rem;
	border: none;
	border-radius: 999px;
	background: transparent;
	color: var(--wp--preset--color--black, #000);
	font-size: 0.75rem;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.03em;
	cursor: pointer;
	overflow: hidden;
	min-height: 2.75rem; /* 44px WCAG touch target */
	min-width: 2.75rem;
	box-shadow: inset 0 0 0 1px color-mix(in oklch, currentcolor 15%, transparent);
	transition:
		box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
		color 0.35s cubic-bezier(0.4, 0, 0.2, 1);

	/* Override WooCommerce's pill background custom property. */
	--pill-background-color: transparent;

	/* Wipe fill — slides in from left on select. */
	&::before {
		content: "";
		position: absolute;
		inset: 0;
		background: var(--wp--preset--color--black, #000);
		transform: scaleX(0);
		transform-origin: left;
		opacity: 0;
		transition:
			transform 0.35s cubic-bezier(0.4, 0, 0.2, 1),
			opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1);
		z-index: 0;
		border-radius: inherit;
	}

	&:hover {
		box-shadow: inset 0 0 0 1px currentcolor;
	}

	&:focus-within {
		background: transparent;
	}

	&:has(input:focus-visible) {
		outline: 2px solid var(--wp--preset--color--black, #000);
		outline-offset: 2px;
	}

	/* Selected state — wipe fill visible, text inverts. */
	&:has(input:checked) {
		--pill-background-color: transparent;

		box-shadow: inset 0 0 0 1px var(--wp--preset--color--black, #000);
		color: var(--wp--preset--color--white, #fff);
		background: transparent;

		&::before {
			transform: scaleX(1);
			opacity: 1;
		}
	}
}

/*
 * 2. Checkmark icon inside pills.
 *    Space is always allocated → only transforms + opacity animate.
 */
.aa-variation-pill__check {
	position: relative;
	z-index: 1;
	display: flex;
	align-items: center;
	width: 0.75rem;
	margin-right: 0.375rem;
	opacity: 0;
	transform: translateX(-0.5625rem) scale(0);
	transition:
		transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) 0.08s,
		opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);

	svg {
		width: 0.75rem;
		height: 0.75rem;
		stroke: var(--wp--preset--color--white, #fff);
		stroke-width: 2.5;
		stroke-linecap: round;
		stroke-linejoin: round;
		flex-shrink: 0;
	}
}

/* Checkmark visible when checked. */
input:checked ~ .aa-variation-pill__check {
	opacity: 1;
	transform: translateX(0) scale(1);
}

/*
 * 3. Label text inside pills.
 *    Slides right to make room for checkmark on selection.
 */
.aa-variation-pill__name {
	position: relative;
	z-index: 1;
	transform: translateX(-0.5625rem);
	transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

input:checked ~ .aa-variation-pill__name {
	transform: translateX(0);
}

/*
 * 4. Disabled / out-of-stock state.
 */
.aa-variation-pill:has(input:disabled) {
	opacity: 0.4;
	cursor: not-allowed;
	text-decoration: line-through;

	&:hover {
		box-shadow: inset 0 0 0 1px color-mix(in oklch, currentcolor 15%, transparent);
	}

	&::before {
		display: none;
	}
}

/*
 * 5. Reduced motion — disable all animations.
 */
@media (prefers-reduced-motion: reduce) {

	.aa-variation-pill,
	.aa-variation-pill::before {
		transition: none;
	}

	.aa-variation-pill__check,
	.aa-variation-pill__name {
		transition: none;
		transform: none;
	}
}
